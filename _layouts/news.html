---
layout: page
# The News of posts.
---
{% include lang.html %}

{% assign df_strftime_m = site.data.locales[lang].df.archives.strftime | default: '/ %m' %}
{% assign df_dayjs_m = site.data.locales[lang].df.archives.dayjs | default: '/ MM' %}

<div id="news">
  {% if site.news and site.news != empty %}
    {% assign items = site.news %}
  {% else %}
    {% assign items = site.posts %}
  {% endif %}

  {%- comment -%}
    Ensure items are ordered by date descending so the latest date appears first
  {%- endcomment -%}
  {% assign items = items | sort: 'date' | reverse %}

  {%- comment -%}
    Build unique dates list (YYYY-MM-DD) in descending order
  {%- endcomment -%}
  {% assign _date_str = '' %}
  {% for post in items %}
    {% assign d = post.date | date: '%Y-%m-%d' %}
    {% unless _date_str contains d %}
      {% capture _date_str %}{{ _date_str }}|{{ d }}{% endcapture %}
    {% endunless %}
  {% endfor %}
  {% assign dates = _date_str | split: '|' %}
  {% if dates[0] == '' %}
    {% assign dates = dates | slice: 1, dates.size %}
  {% endif %}

  <div class="news-toolbar mb-4 d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center flex-wrap gap-3">
      <div id="news-cats" class="d-flex flex-wrap gap-2"></div>
    </div>

    <div id="news-controls" class="d-flex align-items-center">
      <div class="btn-group btn-group-sm" role="group" aria-label="Granularity">
        <button type="button" class="btn btn-outline-secondary" data-granularity="year">年</button>
        <button type="button" class="btn btn-outline-secondary" data-granularity="month">月</button>
        <button type="button" class="btn btn-outline-secondary active" data-granularity="day">日</button>
      </div>
      <!--
        jump icon button before the date select (removed). If you remove this button,
        the script below will fall back to a keyboard shortcut: press "o" to open the
        currently visible post.
      -->
      <select id="news-date-select" class="form-select form-select-sm ms-2"></select>
    </div>
  </div>

  <div id="news-contents">
    {% for post in items %}
      {% assign d = post.date | date: '%Y-%m-%d' %}
      <div
        class="news-post"
        data-date="{{ d }}"
        data-cats="{{ post.categories | join: ',' }}"
        data-url="{{ post.url | relative_url }}"
        data-title="{{ post.title | escape }}"
        id="news-post-{{ forloop.index0 }}"
      >
        <div class="news-body">
          {{ post.content | markdownify }}
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- load news behavior (external to avoid inline-script CSP issues) -->
  <script defer src="{{ '/assets/js/news.js' | relative_url }}"></script>
</div>
